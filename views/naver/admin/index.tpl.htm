<?php TPL::output('admin/global/header.tpl.htm'); ?>
<?php TPL::output('admin/global/nav_menu.tpl.htm'); ?>

<div class="pull-left right-side">
	<?php if ($this->writable_check) { ?>
	<?php foreach ($this->writable_check as $key => $val) { ?>
	<?php if (!$val) { ?>
	<div class="alert alert-danger"><?php echo $key; ?> <?php _e('文件夹无法写入, 请检查并将文件夹权限设置为 0777'); ?></div>
	<?php } ?>
	<?php } ?>
	<?php } ?>
	
	<div class="aw-box pull-left" style="width: 65%">
		<div class="aw-mod-head"><h2><?php _e('数据统计'); ?></h2></div>
		<div class="aw-mod-body">
			<canvas id="charts" height="480"></canvas>
			
			<p align="center"><span class="label label-info"><?php _e('发问'); ?></span> &nbsp; <span class="label"><?php _e('回答'); ?></span></p>
		</div>
	</div>
	
	<div class="aw-message-box pull-left aw-no-margin-top hide" id="admin_notify">
		<div class="aw-mod-head"><h3><?php _e('最新程序更新与补丁'); ?></h3></div>
		<div class="aw-mod-body">
			<ul></ul>
		</div>
	</div>
	<div class="aw-message-box pull-left aw-no-margin-top aw-no-border-bottom">
		<table width="100%" class="aw-table" style="border:none;margin:0px;">
			<thead>
				<tr>
					<th colspan="2"><?php _e('系统信息'); ?></th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td><?php _e('PHP 版本'); ?></td>
					<td><?php echo PHP_VERSION; ?></td>
				</tr>
				<tr>
					<td><?php _e('MySQL 版本'); ?></td>
					<td><?php echo MYSQL_VERSION; ?></td>
				</tr>
				<tr>
					<td><?php _e('会员总数'); ?></td>
					<td><?php echo $this->users_count; ?></td>
				</tr>
				<tr>
					<td><?php _e('Email 激活会员'); ?></td>
					<td><?php echo $this->users_valid_email_count; ?></td>
				</tr>
				<tr>
					<td><?php _e('问题总数'); ?></td>
					<td><?php echo $this->question_count; ?></td>
				</tr>
				<tr>
					<td><?php _e('回答总数'); ?></td>
					<td><?php echo $this->answer_count; ?></td>
				</tr>
				<tr>
					<td><?php _e('等待回答的问题'); ?></td>
					<td><?php echo $this->question_no_answer_count; ?></td>
				</tr>
				<tr>
					<td><?php _e('最佳答案数量'); ?></td>
					<td><?php echo $this->best_answer_count; ?></td>
				</tr>
				<tr>
					<td><?php _e('话题总数'); ?></td>
					<td><?php echo $this->topic_count; ?></td>
				</tr>
				<tr>
					<td><?php _e('附件总数'); ?></td>
					<td><?php echo $this->attach_count; ?></td>
				</tr>
				<tr>
					<td><?php _e('待审核问题'); ?></td>
					<td><?php echo $this->approval_question_count; ?></td>
				</tr>
				<tr>
					<td><?php _e('待审核回答'); ?></td>
					<td><?php echo $this->approval_answer_count; ?></td>
				</tr>
			</tbody>
		</table>
	</div>
</div>

<script type="text/javascript">
$(window).load(function() {
	$('#charts').attr('width', $('#charts').parent().width());
	
	new Chart(document.getElementById("charts").getContext("2d")).Line({
		labels : [<?php foreach($this->statistic_questions AS $key => $val) { ?><?php if ($key > 0) { ?>, <?php } ?>'<?php echo $val['date']; ?>'<?php } ?>],
		datasets : [
			{
				fillColor : "rgba(151,187,205,0.5)",
				strokeColor : "rgba(151,187,205,1)",
				pointColor : "rgba(151,187,205,1)",
				pointStrokeColor : "#fff",
				data : [<?php foreach($this->statistic_questions AS $key => $val) { ?><?php if ($key > 0) { ?>, <?php } ?><?php echo $val['count']; ?><?php } ?>]
			},
			{
				fillColor : "rgba(220,220,220,0.5)",
				strokeColor : "rgba(220,220,220,1)",
				pointColor : "rgba(220,220,220,1)",
				pointStrokeColor : "#fff",
				data : [<?php foreach($this->statistic_answers AS $key => $val) { ?><?php if ($key > 0) { ?>, <?php } ?><?php echo $val['count']; ?><?php } ?>]
			}
		]
	});
	
	$.getJSON('http://wenda.wecenter.com/api/admin_notify.php?jsoncallback=?', function(result)
	{
		if (result)
		{
			$('#admin_notify').find('ul').html(result.notify);
			$('#admin_notify').fadeIn();
		}
	});
});
</script>

<?php TPL::output('admin/global/footer.tpl.htm'); ?>